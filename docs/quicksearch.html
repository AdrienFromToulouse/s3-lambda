<html>
<head>
</head>
<body style="background: transparent;">
    <script src="scripts/docstrap.lib.js"></script>
    <script src="scripts/lunr.min.js"></script>
    <script src="scripts/fulltext-search.js"></script>

    <script type="text/x-docstrap-searchdb">
    {"classes.list.html":{"id":"classes.list.html","title":"Classes","body":" Documentation Classes BatchContextS3renity Classes Classes BatchContext S3renity × Search results Close Documentation generated by JSDoc 3.4.0 on 2016-01-01T23:45:36-05:00 using the DocStrap template. "},"index.html":{"id":"index.html","title":"Index","body":" Documentation Classes BatchContextS3renity S3renityA powerful toolbelt for batch operations in S3. S3renity provides forEach, map, reduce, filter, as well as a friendly promise-based wrapper around the S3 api. Quickly prototype MapReduce jobs Clean or organize dirty log files Perform sync or async functions over each file with forEach, map, reduce, and filter Many more... Getting startedInstall S3renity npm install s3renity --saveQuick Example var S3renity = require('s3renity'); var s3renity = new S3renity({ access_key_id: 'your access key', secret_access_key: 'your secret key' }); // Print out the contents of every file in an S3 directory var folder = 's3://&lt;bucket&gt;/path/to/folder/'; var print = body =&gt; console.log('this is a s3 object:', body); s3renity .context(folder) // sets the directory in S3 .forEach(print) // function to perform over each s3 object .then(_ =&gt; console.log('done!')) // continue .catch(e =&gt; console.log(e)) // handle errorOptions{ verbose: true, // default: false }InputBefore operating over S3 files, you must tell S3renity where to get the S3 objects and how to treat them. There are a few functions you can use before calling a batch function. S3renity.context(dir)RequiredSets the directory in S3 to work on. s3renity.context('s3://&lt;bucket&gt;/path/to/dir')...S3renity.marker(start)OptionalTells S3renity which file to start on, proceeding alphabetically from start. This is the same way marker works in getObject() in the S3 spec. s3renity .context('s3://&lt;bucket&gt;/path/to/dir/') .marker('1234.text') ...S3renity.encode(encoding)OtionalTells S3renity what encoding to use when calling toString() on the S3 object body (default is 'utf8'). Alternatively, you can use S3renity.transform to do something else to load the file. s3renity .context('s3://&lt;bucket&gt;/path/to/dir/') .encode('ascii') ...S3renity.transform(func)OptionalTells S3renity to run func over S3 objects before using them. For example, you may want to use zlib to unzip files before processing. var zlib = require('zlib'); S3renity .context('s3://&lt;bucket&gt;/path/to/dir/') .transform(obj =&gt; zlib.gunzipSync(obj).toString('utf8')) ...S3renity.split(delimiter)OptionalTells S3renity to work over the deliminations of objects instead of the objects themselves. For example, calling S3renity.split('\\n') would tell S3renity to perform operations over each line in each file. S3renity .context('s3//&lt;bucket&gt;/path/to/dir/') .split('\\n') .forEach(line =&gt; console.log(line))Batch Functions forEach map reduce filter forEach(func[, isAsync])Perform func on every item in the working context. If split is called, func takes a string. Otherwise, it takes an S3 object. func either performs a synchronous action on the argument, or returns a promise. s3renity .context(path) .forEach(func) .then(_ =&gt; {}) .catch(e =&gt; {}) s3renity .context(path) .split('\\n') .forEach(func) .then(_ =&gt; {}) .catch(e =&gt; {})map(func[, isAsync])Destructuve (unless output is specified)Perform func on every item in the working context, replacing each in place. If split is called, func takes a string. Otherwise, it takes an S3 object. func is either synchronous that returns the new object (or item) or returns a promise that resolves to the new object. s3renity .context(path) .output(outputFolder) // optional .map(func) .then(_ =&gt; {}) .catch(e =&gt; {}) s3renity .context(path) .split('\\n') .map(func) .then(_ =&gt; {}) .catch(e =&gt; {})reduce(func[, initialValue, isAsync])Reduce the working context to a single value with func. func takes three arguments: previousValue, currentValue, and key (the key of the current S3 object), and returns the updated object. s3renity .context(path) .reduce(func) .then(result =&gt; {}) .catch(e =&gt; {}) s3renity .context(path) .split('\\n') .reduce(func) .then(result =&gt; {}) .catch(e =&gt; {})filter(func)Destructive (unless output is specified)Filter the working context with func, removing all objects or entries that don't pass the test. This function is destructive unless if you specify an output. If split is called, func takes a string. Otherwise, it takes an S3 object. func is either synchronous or returns a promise, and returns false if the item should be filtered. s3renity .context(path) .output(outputFolder) // optional .filter(func) .then(_ =&gt; {}) .catch(e) s3renity .context(path) .split('\\n') .filter(func) .then(_ =&gt; ...) .catch(e)Extra Functionality list get put delete join write splitObject list()List all the keys in the working context. s3renity .context(path) .list() .then(keys =&gt; {}) .catch(e =&gt; {})get(arg1[, arg2])Get an object from S3 either by specifying a valid key, or separate them into two arguments key and bucket. s3renity .get('bucket', 'path/to/object') .then(object =&gt; {}) .catch(e =&gt; {}) s3renity .get('s3://path/to/object') .then(object =&gt; ...) .catch(e =&gt; ...)put(bucket, key, body)Put an object in S3. s3renity .put(bucket, key, body) .then(_ =&gt; ...) .catch(e =&gt; ...)delete(bucket, key)Delete an object or list of objects from S3. Key can be a string key, the object to delete, or an array of keys to delete. s3renity.delete('bucket', 'path/to/file.txt') s3renity.delete('bucket', ['s3://bucket/path/to/thing', 's3://bucket/path/to/thing2'])join(delimiter)Joins the objects in the working context by delimiter and returns the result. s3renity .context(path) .join('\\n') .then(result =&gt; console.log(result)) .catch(e =&gt; ...)write(body, targets)Output the working context to a file or location in s3. Targets can be a string (single target) or an array of targets. Targets can be local files or valid S3 paths. var text = 'blah'; s3renity.write(text, ['s3://bucket/path/to/file.txt', 'localfile.txt']);splitObject(bucket, key[, delimiter, encoding])Split a single (text) object in S3 by a delimiter. Default delimiter is \\n and encoding is utf8. s3renity .context(path) .splitObject('bucket', 'path/to/object', '\\t'); .then(result =&gt; {}) // do something with result .catch(console.log)Advanced ExamplesPerform an asynchronous db lookup for every line of JSON in every file in the working context. const lookupId = line =&gt; { line = JSON.parse(line); return new Promise((success, fail) =&gt; { db.lookup(line.id).then(success).catch(fail); }); }; s3renity .context(path) .split('\\n') .forEach(lookupId, true) .then(_ =&gt; console.log('done!')) .catch(e =&gt; console.log(e))Add a field to each log entry and then concatonate all the files into one and save it locally. var folder = 's3://bucket/path/to/folder'; var tmpFolder = 's3://bucket/path/to/temporary/output/folder'; var localOutput = 'output.txt'; s3renity .context(folder) .split('\\n') .target(tmpFolder) .map(entry =&gt; { var temp = JSON.parse(entry); if (temp.timestamp == null) { temp.timestamp = Date.now()/1000|0; } return temp; }) .then(_ =&gt; { s3renity.ctx(tmpFolder).join('\\n').then(results =&gt; { s3renity.write(results, localOutput); })} ) .catch(err =&gt; console.log(err)); × Search results Close Documentation generated by JSDoc 3.4.0 on 2016-01-01T23:45:36-05:00 using the DocStrap template. "},"BatchContext.html":{"id":"BatchContext.html","title":"Class: BatchContext","body":" Documentation Classes BatchContextS3renity Class: BatchContext BatchContext A `BatchContext` enables you to set reusable conditions for batch requests. new BatchContext(key, marker, s3renity) Creates a new `BatchContext` to perform batch operations with. Parameters: Name Type Argument Description key String A valid S3 key, which is used to generate the context for the batch operations marker String &lt;optional&gt; The marker to start at when getting objects from `key`. s3renity S3renity The s3renity instance to use in batch requests Methods encode(encoding) Sets the encoding. Parameters: Name Type Description encoding String The encoding Returns: `this` Type BatchContext forEach(func, isAsync) Returns a for each batch request. Parameters: Name Type Description func function This function takes an s3 object and performs a synchronous function. If isAsync is true, func returns a promise. isAsync Boolean Optional. Default is false. If set to true, this indicates that func returns a promise that should be executed. Returns: Fulfilled when the mapper functions are done. Returns a list of keys that were operated over. Type Promise map(func, isAsync) Parameters: Name Type Description func function This function takes an s3 object and returns the updated object. isAsync Boolean Whether the function is asynchronous (returns a promise). Returns: Type Promise marker(marker) Sets the marker. Parameters: Name Type Description marker String The marker to start with for getting objects. Returns: `this` Type BatchContext reduce(func, initialValue, isAsync) Parameters: Name Type Description func function The reducer function. initialValue Mixed The value to start with in `func`. isAsync Boolean Whether the function is asynchronous (returns a promise). split(delimiter) Move the context from s3 objects to objects split by a delimiter. Parameters: Name Type Description delimiter String The character to split the document objects by - Defaults to &quot;\\n&quot; Returns: `this` Type BatchContext target(target) Sets the output directory for map or filter. If a target is set, map and filter write to that location instead of changing the original objects themselves. Parameters: Name Type Description target String The location to send the output of map or filter. Returns: `this` Type Context transform(transform) Sets a transformation function to use when getting objects from s3. Parameters: Name Type Description transform function The function to use to transform the object. Returns: `this` Type BatchContext × Search results Close Documentation generated by JSDoc 3.4.0 on 2016-01-01T23:45:36-05:00 using the DocStrap template. "},"S3renity.html":{"id":"S3renity.html","title":"Class: S3renity","body":" Documentation Classes BatchContextS3renity Class: S3renity S3renity A S3renity instance allows you to create contexts for batch requests. It also gives you a promise-based wrapper around the S3 api. new S3renity(config) Parameters: Name Type Description config Object Options to initialize s3renity with. If `access_key_id` and `secret_access_key` are left out, the aws sdk will attempt to use the computer's default credentials. Properties Name Type Argument Default Description access_key_id String &lt;optional&gt; null AWS Access Key secret_access_key String &lt;optional&gt; null AWS Secret Key timeout Integer &lt;optional&gt; 120 Timeout allowed for aws api requests maxRetries Integer &lt;optional&gt; 30 Max retries allowed for aws api requets verbose Boolean &lt;optional&gt; false Whether to use verbose mode when making requets Methods context(bucket, prefix, marker) Creates a new `BatchContext` for performing batch operations. Parameters: Name Type Description bucket String The S3 bucket prefix String The folder prefix for where the files are marker String Optional. A prefix that indicates where to start listing files alphabetically. Returns: Type BatchContext copy(bucket, key, targetBucket, targetKey) Copies an object in S3. Parameters: Name Type Description bucket String The source bucket. key String The source key. targetBucket String The target bucket. targetKey String The target key. Returns: Type Promise delete(bucket, key) Deletes an object in S3. Parameters: Name Type Description bucket String The bucket key String The key to delete Returns: Type Promise get(bucket, key, encoding, transformer) Parameters: Name Type Argument Default Description bucket String The bucket to get from key String The key of the object to get encoding String &lt;optional&gt; utf8 The encoding transformer function &lt;optional&gt; If supplied, this function will be run on Object.Body before returning. Useful for dealing with compressed files or weird formats Returns: The s3 text object. Type Promise list(bucket, prefix, marker) Lists all the keys in the given s3 folder. Parameters: Name Type Argument Description bucket String The bucket prefix String The prefix for the folder to list keys for marker String &lt;optional&gt; The key to start listing from, alphabetically Returns: Array containing all the keys in `s3://bucket/prefix` Type Promise put(bucket, key, body, encoding) Puts a text object in S3. Parameters: Name Type Argument Default Description bucket String The s3 bucket to use key String The key path where the object will be placed body String The object body encoding String &lt;optional&gt; utf8 The encoding Returns: Promise that resolves when the object is written to s3 Type Promise × Search results Close Documentation generated by JSDoc 3.4.0 on 2016-01-01T23:45:37-05:00 using the DocStrap template. "}}
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            Searcher.init();
        });

        $(window).on("message", function(msg) {
            var msgData = msg.originalEvent.data;

            if (msgData.msgid != "docstrap.quicksearch.start") {
                return;
            }

            var results = Searcher.search(msgData.searchTerms);

            window.parent.postMessage({"results": results, "msgid": "docstrap.quicksearch.done"}, "*");
        });
    </script>
</body>
</html>
